<!-- Version 5.5 - Copy Code Feature Added - Deployed: 2025-08-27 -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultura Builder - Manuscrito Digital</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <!-- Lucide Icons v3 - Updated 2025 -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js?v=20250822"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Dark Theme (Default) - Professional Book Style */
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #666666;
            --accent: #ffffff;
            --border: rgba(255, 255, 255, 0.1);
            --sidebar-width: 320px;
            --code-bg: #1a1a1a;
            
            /* Typography System */
            --font-serif: 'Georgia', 'Times New Roman', serif;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', 'Courier New', monospace;
            
            /* Book-like spacing */
            --paragraph-spacing: 1.5em;
            --line-height-body: 1.8;
            --letter-spacing-body: 0.01em;
        }
        
        /* Light Theme */
        body.light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --text-tertiary: #9ca3af;
            --accent: #111827;
            --border: rgba(0, 0, 0, 0.1);
            --code-bg: #f3f4f6;
        }
        
        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            transition: background 0.3s, color 0.3s;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Content Protection - Copyright */
        .content-area * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-user-drag: none;
        }
        
        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background 0.3s;
        }
        
        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
        }
        
        .sidebar-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 16px;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--bg-primary);
        }
        
        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            pointer-events: none;
        }
        
        /* Chapters List */
        .chapters-list {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }
        
        .chapters-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .chapters-list::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chapters-list::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
        
        .chapters-list::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
        
        /* Section Headers */
        .section-header {
            padding: 12px 8px 8px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
            border-bottom: 1px solid var(--border);
            margin-bottom: 8px;
            margin-top: 16px;
        }
        
        .section-header:first-child {
            margin-top: 0;
        }
        
        /* Chapter Items */
        .chapter-item {
            padding: 10px 12px;
            margin: 2px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chapter-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .chapter-item.active {
            background: var(--accent);
            color: var(--bg-primary);
            font-weight: 600;
        }
        
        body.light-mode .chapter-item.active {
            background: var(--accent);
            color: var(--bg-primary);
        }
        
        .chapter-number {
            min-width: 24px;
            font-size: 12px;
            opacity: 0.7;
        }
        
        .chapter-title {
            flex: 1;
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            overflow: hidden;
        }
        
        /* Content Header */
        .content-header {
            padding: 20px 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
            min-height: 72px;
        }
        
        .current-chapter {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Control Buttons */
        .controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .control-btn {
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }
        
        .control-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }
        
        .control-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }
        
        body.light-mode .control-btn:hover,
        body.light-mode .control-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
        }
        
        /* Content Area - Professional Book Typography */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 60px 80px;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            background: var(--bg-primary);
        }
        
        .content-area::-webkit-scrollbar {
            width: 8px;
        }
        
        .content-area::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        
        .content-area::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        .content-area::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
        
        /* Professional Book Typography */
        .chapter-container {
            font-family: var(--font-serif);
            line-height: var(--line-height-body);
            letter-spacing: var(--letter-spacing-body);
            color: var(--text-primary);
        }
        
        .chapter-container h1 {
            font-family: var(--font-sans);
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 40px;
            letter-spacing: -0.02em;
            line-height: 1.1;
            color: var(--text-primary);
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid var(--border);
        }
        
        .chapter-container h2 {
            font-family: var(--font-sans);
            font-size: 32px;
            font-weight: 700;
            margin-top: 48px;
            margin-bottom: 24px;
            letter-spacing: -0.01em;
            color: var(--text-primary);
        }
        
        .chapter-container h3 {
            font-family: var(--font-sans);
            font-size: 24px;
            font-weight: 600;
            margin-top: 32px;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .chapter-container h4 {
            font-family: var(--font-sans);
            font-size: 20px;
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 12px;
            color: var(--text-secondary);
        }
        
        /* Book-style paragraphs */
        .chapter-container p {
            margin-bottom: var(--paragraph-spacing);
            text-align: justify;
            text-indent: 2em;
            font-size: 18px;
            color: var(--text-primary);
        }
        
        /* First paragraph after heading - no indent */
        .chapter-container h1 + p,
        .chapter-container h2 + p,
        .chapter-container h3 + p,
        .chapter-container h4 + p,
        .chapter-container hr + p {
            text-indent: 0;
        }
        
        /* Drop cap for chapter start */
        .chapter-container > p:first-of-type:first-letter {
            float: left;
            font-size: 96px;
            line-height: 80px;
            padding-right: 8px;
            margin-top: -8px;
            font-weight: 700;
            color: var(--accent);
        }
        
        /* Lists */
        .chapter-container ul,
        .chapter-container ol {
            margin: 24px 0;
            padding-left: 40px;
        }
        
        .chapter-container li {
            margin-bottom: 12px;
            font-size: 17px;
            line-height: 1.8;
            color: var(--text-primary);
        }
        
        /* Blockquotes - Book Style */
        .chapter-container blockquote {
            margin: 32px 20px;
            padding: 24px 32px;
            border-left: 4px solid var(--accent);
            background: var(--bg-secondary);
            font-style: italic;
            font-size: 19px;
            line-height: 1.8;
            color: var(--text-secondary);
            border-radius: 8px;
            position: relative;
        }
        
        .chapter-container blockquote::before {
            content: '"';
            position: absolute;
            top: -10px;
            left: 20px;
            font-size: 60px;
            color: var(--accent);
            opacity: 0.3;
        }
        
        /* Code blocks with copy button */
        .code-block-wrapper {
            position: relative;
            margin: 24px 0;
        }
        
        .chapter-container pre {
            background: var(--code-bg);
            padding: 20px;
            padding-top: 40px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid var(--border);
            margin: 0;
        }
        
        .chapter-container code {
            font-family: var(--font-mono);
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 10;
        }
        
        .copy-button:hover {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }
        
        .copy-button.copied {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        
        body.light-mode .copy-button.copied {
            background: #10b981;
            color: white;
        }
        
        /* Horizontal Rules */
        .chapter-container hr {
            border: none;
            height: 1px;
            background: var(--border);
            margin: 48px auto;
            width: 50%;
            position: relative;
        }
        
        /* Professional section break */
        .chapter-container hr::after {
            content: '• • •';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-primary);
            padding: 0 20px;
            color: var(--text-tertiary);
            font-size: 20px;
            letter-spacing: 8px;
        }
        
        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: var(--text-tertiary);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .content-area {
                padding: 40px 20px;
            }
            
            .chapter-container h1 {
                font-size: 32px;
            }
            
            .chapter-container p {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-title">CULTURA BUILDER</h1>
                <div class="search-container">
                    <input type="text" 
                           class="search-input" 
                           id="searchInput"
                           placeholder="Buscar..." 
                           onkeyup="searchChapters()">
                    <i data-lucide="search" class="search-icon w-4 h-4"></i>
                </div>
            </div>
            <div class="chapters-list" id="chaptersList">
                <!-- Chapters will be loaded here -->
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h2 class="current-chapter" id="currentChapter">Carregando...</h2>
                <div class="controls">
                    <button class="control-btn" onclick="toggleTheme()">
                        <i data-lucide="sun" class="w-4 h-4"></i>
                    </button>
                    <button class="control-btn" onclick="decreaseFontSize()">
                        <i data-lucide="minus" class="w-4 h-4"></i>
                    </button>
                    <button class="control-btn" onclick="increaseFontSize()">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                    </button>
                    <button class="control-btn" id="playBtn" onclick="toggleVoiceOver()" title="Narrador">
                        <i data-lucide="volume-2" class="w-4 h-4"></i>
                        <span style="margin-left: 8px; font-size: 13px;">Narrador</span>
                    </button>
                </div>
            </header>
            <div class="content-area" id="contentArea">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </main>
    </div>
    
    <script>
        // Optimized Emoji Replacement - Lazy loaded
        function replaceEmojisWithIcons(html) {
            // Simple regex to remove ALL emojis efficiently
            const emojiRegex = /[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F900}-\u{1F9FF}]|[\u{1FA70}-\u{1FAFF}]|[\u{2300}-\u{23FF}]|[\u{2B00}-\u{2BFF}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F1FF}]|[\u{1F200}-\u{1F2FF}]|[\u{1F780}-\u{1F7FF}]|[\u{1F800}-\u{1F8FF}]|[\u{1FA00}-\u{1FA6F}]|[\u231A-\u231B]|[\u23E9-\u23F3]|[\u23F8-\u23FA]|[\u25AA-\u25AB]|[\u25FB-\u25FE]|[\u2934-\u2935]|[\u2B05-\u2B07]|[\u2B1B-\u2B1C]|[\u2B50]|[\u2B55]|[\u3030]|[\u303D]|[\u3297]|[\u3299]|[\u00A9]|[\u00AE]|[\u2122]|[\u23F0]|[\u2764]/gu;
            
            // Replace with a simple icon
            const iconStyle = 'style="display:inline-block;width:1.2em;height:1.2em;vertical-align:middle;margin:0 2px;"';
            html = html.replace(emojiRegex, `<i data-lucide="circle" ${iconStyle}></i>`);
            
            // Re-initialize Lucide icons after replacement
            setTimeout(() => {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }, 100);
            
            return html;
        }
        
        // Infinite Scroll Variables (Always On)
        let currentChapterIndex = 0;
        let loadedChapters = [];
        let isLoadingNext = false;
        
        // Chapter Data Structure
        const allChapters = [
            { id: 'capa', title: 'Capa', file: 'capa.md' },
            { id: 'introducao', title: 'Introdução', file: 'introducao.md' },
            
            // PARTE I - O DESPERTAR
            { id: 'parte1', title: 'PARTE I • O DESPERTAR', isSection: true },
            { id: 'cap1', title: 'Por Que Desta Vez É Diferente', number: 1, file: 'capitulo-01.md' },
            { id: 'cap2', title: 'O Mito da Destruição em Massa de Empregos', number: 2, file: 'capitulo-02.md' },
            { id: 'cap3', title: 'Por Que o Brasil Tem Vantagem Única', number: 3, file: 'capitulo-03.md' },
            
            // PARTE II - ENTENDENDO O JOGO
            { id: 'parte2', title: 'PARTE II • ENTENDENDO O JOGO', isSection: true },
            { id: 'cap4', title: 'O Que É IA (Sem Tecniquês)', number: 4, file: 'capitulo-04.md' },
            { id: 'cap5', title: 'Como a IA Realmente Funciona', number: 5, file: 'capitulo-05.md' },
            { id: 'cap6', title: 'Desmistificando os Medos', number: 6, file: 'capitulo-06.md' },
            
            // PARTE III - MINDSET BUILDER
            { id: 'parte3', title: 'PARTE III • MINDSET BUILDER', isSection: true },
            { id: 'cap7', title: 'A Mentalidade do Construtor', number: 7, file: 'capitulo-07.md' },
            { id: 'cap8', title: 'Destruindo Crenças Limitantes', number: 8, file: 'capitulo-08.md' },
            { id: 'cap9', title: 'O Poder do Aprendizado Contínuo', number: 9, file: 'capitulo-09.md' },
            
            // PARTE IV - MÃOS À OBRA
            { id: 'parte4', title: 'PARTE IV • MÃOS À OBRA', isSection: true },
            { id: 'cap10', title: 'Seu Primeiro Projeto com IA', number: 10, file: 'capitulo-10.md' },
            { id: 'cap11', title: 'Automatizando Tarefas do Dia a Dia', number: 11, file: 'capitulo-11.md' },
            { id: 'cap12', title: 'Criando Conteúdo com IA', number: 12, file: 'capitulo-12.md' },
            
            // PARTE V - HABILIDADES HUMANAS
            { id: 'parte5', title: 'PARTE V • HABILIDADES HUMANAS', isSection: true },
            { id: 'cap13', title: 'O Que a IA Não Pode Substituir', number: 13, file: 'capitulo-13.md' },
            { id: 'cap14', title: 'Desenvolvendo Inteligência Emocional', number: 14, file: 'capitulo-14.md' },
            { id: 'cap15', title: 'Criatividade na Era da IA', number: 15, file: 'capitulo-15.md' },
            
            // PARTE VI - CARREIRA BUILDER
            { id: 'parte6', title: 'PARTE VI • CARREIRA BUILDER', isSection: true },
            { id: 'cap16', title: 'As Profissões do Futuro', number: 16, file: 'capitulo-16.md' },
            { id: 'cap17', title: 'Como Se Reposicionar no Mercado', number: 17, file: 'capitulo-17.md' },
            { id: 'cap18', title: 'Construindo Sua Marca Pessoal', number: 18, file: 'capitulo-18.md' },
            
            // PARTE VII - EMPRESAS BUILDERS
            { id: 'parte7', title: 'PARTE VII • EMPRESAS BUILDERS', isSection: true },
            { id: 'cap19', title: 'Transformando Empresas com IA', number: 19, file: 'capitulo-19.md' },
            { id: 'cap20', title: 'Casos de Sucesso no Brasil', number: 20, file: 'capitulo-20.md' },
            { id: 'cap21', title: 'Implementando IA na Sua Empresa', number: 21, file: 'capitulo-21.md' },
            
            // PARTE VIII - ÉTICA E RESPONSABILIDADE
            { id: 'parte8', title: 'PARTE VIII • ÉTICA E RESPONSABILIDADE', isSection: true },
            { id: 'cap22', title: 'Os Dilemas Éticos da IA', number: 22, file: 'capitulo-22.md' },
            { id: 'cap23', title: 'Privacidade e Segurança', number: 23, file: 'capitulo-23.md' },
            { id: 'cap24', title: 'IA Responsável e Inclusiva', number: 24, file: 'capitulo-24.md' },
            
            // PARTE IX - CASES REAIS
            { id: 'parte9', title: 'PARTE IX • CASES REAIS', isSection: true },
            { id: 'cap25', title: 'Do Zero aos R$ 10k/mês', number: 25, file: 'capitulo-25.md' },
            { id: 'cap26', title: 'Empresas que Se Reinventaram', number: 26, file: 'capitulo-26.md' },
            { id: 'cap27', title: 'Jovens Builders Brasileiros', number: 27, file: 'capitulo-27.md' },
            
            // PARTE X - BRASIL BUILDER
            { id: 'parte10', title: 'PARTE X • BRASIL BUILDER', isSection: true },
            { id: 'cap28', title: 'O Potencial Único do Brasil', number: 28, file: 'capitulo-28.md' },
            { id: 'cap29', title: 'Superando os Desafios Nacionais', number: 29, file: 'capitulo-29.md' },
            { id: 'cap30', title: 'O Ecossistema de Inovação', number: 30, file: 'capitulo-30.md' },
            
            // PARTE XI - SEU FUTURO
            { id: 'parte11', title: 'PARTE XI • SEU FUTURO', isSection: true },
            { id: 'cap31', title: 'Seu Plano de Ação', number: 31, file: 'capitulo-31.md' },
            { id: 'cap32', title: 'Recursos e Ferramentas', number: 32, file: 'capitulo-32.md' },
            { id: 'cap33', title: 'A Jornada Continua', number: 33, file: 'capitulo-33.md' },
            
            // BÔNUS - CLAUDE CODE
            { id: 'bonus', title: 'BÔNUS • FERRAMENTAS BUILDER', isSection: true },
            { id: 'cap34', title: 'Dominando o Claude Code - Guia Completo', number: 34, file: 'capitulo-34.md' },
            
            // Epílogo e Referências
            { id: 'epilogo', title: 'Epílogo', file: 'epilogo.md' },
            { id: 'referencias', title: 'Referências', file: 'referencias.md' }
        ];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadChaptersList();
            loadFirstChapter();
            setupInfiniteScroll();
            lucide.createIcons();
        });
        
        // Load chapters list
        function loadChaptersList() {
            const container = document.getElementById('chaptersList');
            container.innerHTML = '';
            
            allChapters.forEach(chapter => {
                if (chapter.isSection) {
                    const section = document.createElement('div');
                    section.className = 'section-header';
                    section.textContent = chapter.title;
                    container.appendChild(section);
                } else {
                    const item = document.createElement('div');
                    item.className = 'chapter-item';
                    item.id = `chapter-${chapter.id}`;
                    item.innerHTML = `
                        ${chapter.number ? `<span class="chapter-number">${chapter.number}</span>` : ''}
                        <span class="chapter-title">${chapter.title}</span>
                    `;
                    item.onclick = () => loadChapter(chapter);
                    container.appendChild(item);
                }
            });
        }
        
        // Load first chapter
        async function loadFirstChapter() {
            const firstChapter = allChapters.find(ch => !ch.isSection);
            if (firstChapter) {
                await loadChapter(firstChapter);
            }
        }
        
        // Load single chapter (replaces all content)
        async function loadChapter(chapter) {
            const contentArea = document.getElementById('contentArea');
            const currentChapterEl = document.getElementById('currentChapter');
            
            // Clear loaded chapters for fresh start
            loadedChapters = [];
            
            // Update current chapter index
            currentChapterIndex = allChapters.findIndex(ch => ch.id === chapter.id);
            
            // Update active state
            document.querySelectorAll('.chapter-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(`chapter-${chapter.id}`)?.classList.add('active');
            
            // Show loading
            contentArea.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            currentChapterEl.textContent = chapter.title;
            
            try {
                const response = await fetch(`/manuscrito-flat/${chapter.file}`);
                const markdown = await response.text();
                let html = convertMarkdownToHTML(markdown);
                
                // Replace emojis
                html = replaceEmojisWithIcons(html);
                
                contentArea.innerHTML = `
                    <div class="chapter-container" data-chapter-id="${chapter.id}">
                        ${html}
                        <div style="text-align: center; padding: 40px 0; color: var(--text-tertiary); font-size: 14px;">
                            Capítulo ${chapter.number || ''} • ${chapter.title}
                        </div>
                    </div>
                `;
                contentArea.scrollTop = 0;
                
                loadedChapters.push(chapter.id);
                lucide.createIcons();
                
            } catch (error) {
                contentArea.innerHTML = '<p style="color: var(--text-tertiary); text-align: center;">Erro ao carregar capítulo</p>';
            }
        }
        
        // Append next chapter for infinite scroll
        async function loadNextChapter() {
            if (isLoadingNext) return;
            
            const nextIndex = currentChapterIndex + 1;
            
            // Skip section headers and check if we have more chapters
            let nextChapter = null;
            for (let i = nextIndex; i < allChapters.length; i++) {
                if (!allChapters[i].isSection) {
                    nextChapter = allChapters[i];
                    currentChapterIndex = i;
                    break;
                }
            }
            
            if (!nextChapter || loadedChapters.includes(nextChapter.id)) return;
            
            isLoadingNext = true;
            const contentArea = document.getElementById('contentArea');
            
            // Add loading indicator
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading-next';
            loadingDiv.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--text-tertiary);">
                    <div class="loading-spinner" style="margin: 0 auto;"></div>
                    <p style="margin-top: 20px;">Carregando próximo capítulo...</p>
                </div>
            `;
            contentArea.appendChild(loadingDiv);
            
            try {
                const response = await fetch(`/manuscrito-flat/${nextChapter.file}`);
                const markdown = await response.text();
                let html = convertMarkdownToHTML(markdown);
                
                // Replace emojis
                html = replaceEmojisWithIcons(html);
                
                // Remove loading indicator
                loadingDiv.remove();
                
                // Add separator
                const separator = document.createElement('div');
                separator.innerHTML = `
                    <div style="text-align: center; padding: 60px 0;">
                        <div style="width: 100px; height: 1px; background: var(--border); margin: 0 auto;"></div>
                    </div>
                `;
                contentArea.appendChild(separator);
                
                // Add new chapter
                const chapterDiv = document.createElement('div');
                chapterDiv.className = 'chapter-container';
                chapterDiv.setAttribute('data-chapter-id', nextChapter.id);
                chapterDiv.innerHTML = `
                    ${html}
                    <div style="text-align: center; padding: 40px 0; color: var(--text-tertiary); font-size: 14px;">
                        Capítulo ${nextChapter.number || ''} • ${nextChapter.title}
                    </div>
                `;
                contentArea.appendChild(chapterDiv);
                
                // Update active chapter in sidebar
                document.querySelectorAll('.chapter-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.getElementById(`chapter-${nextChapter.id}`)?.classList.add('active');
                
                // Update header
                document.getElementById('currentChapter').textContent = nextChapter.title;
                
                loadedChapters.push(nextChapter.id);
                lucide.createIcons();
                
            } catch (error) {
                loadingDiv.innerHTML = '<p style="color: var(--text-tertiary); text-align: center;">Erro ao carregar próximo capítulo</p>';
            }
            
            isLoadingNext = false;
        }
        
        // Monitor scroll position
        function setupInfiniteScroll() {
            const contentArea = document.getElementById('contentArea');
            
            contentArea.addEventListener('scroll', () => {
                if (isLoadingNext) return;
                
                const scrollPosition = contentArea.scrollTop + contentArea.clientHeight;
                const totalHeight = contentArea.scrollHeight;
                
                // Load next chapter when user is 500px from the bottom
                if (scrollPosition > totalHeight - 500) {
                    loadNextChapter();
                }
                
                // Update active chapter based on scroll position
                const chapters = contentArea.querySelectorAll('.chapter-container');
                chapters.forEach(chapter => {
                    const rect = chapter.getBoundingClientRect();
                    if (rect.top < 200 && rect.bottom > 200) {
                        const chapterId = chapter.getAttribute('data-chapter-id');
                        const chapterData = allChapters.find(ch => ch.id === chapterId);
                        if (chapterData) {
                            // Update sidebar active state
                            document.querySelectorAll('.chapter-item').forEach(item => {
                                item.classList.remove('active');
                            });
                            document.getElementById(`chapter-${chapterId}`)?.classList.add('active');
                            
                            // Update header
                            document.getElementById('currentChapter').textContent = chapterData.title;
                        }
                    }
                });
            });
        }
        
        // Convert Markdown to HTML with enhanced features
        function convertMarkdownToHTML(markdown) {
            // Track if we're in a chapter that might have exercises
            const hasExercises = markdown.includes('## Exercício') || 
                                 markdown.includes('### Exercício') ||
                                 markdown.includes('**Exercício') ||
                                 markdown.includes('## Atividade') ||
                                 markdown.includes('### Atividade');
            
            // First handle code blocks
            let html = markdown.replace(/```(\w+)?\n([\s\S]*?)```/g, function(match, lang, code) {
                const codeId = 'code-' + Math.random().toString(36).substr(2, 9);
                return `
                    <div class="code-block-wrapper">
                        <button class="copy-button" onclick="copyCode('${codeId}')">
                            <i data-lucide="copy" style="width: 14px; height: 14px;"></i>
                            <span>Copiar</span>
                        </button>
                        <pre><code id="${codeId}" class="language-${lang || 'text'}">${escapeHtml(code.trim())}</code></pre>
                    </div>
                `;
            });
            
            // Handle inline commands (text between backticks)
            html = html.replace(/`([^`]+)`/g, function(match, command) {
                // Check if it looks like a command (starts with /, contains special chars, etc)
                if (command.startsWith('/') || command.includes('npm ') || command.includes('git ') || 
                    command.includes('claude') || command.includes('curl') || command.includes('bash')) {
                    const cmdId = 'cmd-' + Math.random().toString(36).substr(2, 9);
                    return `<code id="${cmdId}" style="position: relative; padding-right: 24px; cursor: pointer;" onclick="copyInlineCode('${cmdId}')" title="Clique para copiar">${escapeHtml(command)}</code>`;
                }
                return `<code>${escapeHtml(command)}</code>`;
            });
            
            // Then handle other markdown
            html = html
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/^\> (.*$)/gim, '<blockquote>$1</blockquote>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^/g, '<p>')
                .replace(/$/g, '</p>')
                .replace(/<p><\/p>/g, '')
                .replace(/<p>---<\/p>/g, '<hr>');
            
            // Add exercise areas for specific chapters
            if (hasExercises) {
                // Chapter 13 - Creativity exercises
                if (markdown.includes('Cultural Remix') || markdown.includes('Remix Cultural')) {
                    html += createExerciseArea('ch13-remix', 'Exercício Cultural Remix: Escolha uma obra clássica e reimagine em um contexto moderno.');
                }
                if (markdown.includes('Criatividade com Restrições') || markdown.includes('Constraint Creativity')) {
                    html += createExerciseArea('ch13-constraint', 'Exercício de Restrições: Crie algo com limitações absurdas. Qual foi seu resultado?');
                }
                if (markdown.includes('Fusão de Estilos')) {
                    html += createExerciseArea('ch13-fusion', 'Exercício de Fusão: Combine dois estilos impossíveis. Descreva sua criação.');
                }
                if (markdown.includes('Mudança de Perspectiva')) {
                    html += createExerciseArea('ch13-perspective', 'Exercício de Perspectiva: Pegue uma ideia e explore de 3 pontos de vista diferentes.');
                }
                
                // Chapter 16 - Work activities
                if (markdown.includes('mapeamento') && markdown.includes('atividades')) {
                    html += createExerciseArea('ch16-mapping', 'Liste suas atividades de trabalho e avalie o potencial de automação por IA (0-100%).');
                }
                
                // Chapter 22 - Ethics assessment
                if (markdown.includes('Mapeamento de Stakeholders')) {
                    html += createExerciseArea('ch22-stakeholders', 'Mapeie os stakeholders do seu projeto e seus interesses.');
                }
                if (markdown.includes('Avaliação de Impacto')) {
                    html += createExerciseArea('ch22-impact', 'Avalie o impacto potencial do seu projeto em diferentes grupos.');
                }
                
                // Chapter 26 - Career transformation
                if (markdown.includes('Mapeamento de Ativos')) {
                    html += createExerciseArea('ch26-assets', 'Liste seus conhecimentos, habilidades e vantagens competitivas.');
                }
                
                // Chapter 31 - Builder assessment
                if (markdown.includes('Avaliação Builder') || markdown.includes('100 pontos')) {
                    html += createExerciseArea('ch31-assessment', 'Complete sua auto-avaliação Builder (0-100 pontos) e identifique áreas de melhoria.');
                }
            }
            
            // Add quiz after Chapter 34
            if (markdown.includes('Claude Code') && markdown.includes('hub.culturabuilder.com')) {
                html += createQuiz();
            }
                
            return html;
        }
        
        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Copy code to clipboard
        function copyCode(codeId) {
            const codeElement = document.getElementById(codeId);
            if (!codeElement) return;
            
            const text = codeElement.textContent;
            
            // Try using the modern clipboard API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopySuccess(codeElement);
                }).catch(() => {
                    fallbackCopy(text, codeElement);
                });
            } else {
                fallbackCopy(text, codeElement);
            }
        }
        
        // Copy inline code/command
        function copyInlineCode(cmdId) {
            const codeElement = document.getElementById(cmdId);
            if (!codeElement) return;
            
            const text = codeElement.textContent;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    // Visual feedback
                    const originalBg = codeElement.style.background;
                    codeElement.style.background = 'rgba(0, 255, 136, 0.2)';
                    codeElement.style.transition = 'background 0.3s';
                    
                    setTimeout(() => {
                        codeElement.style.background = originalBg;
                    }, 1000);
                    
                    // Show tooltip
                    const tooltip = document.createElement('span');
                    tooltip.textContent = 'Copiado!';
                    tooltip.style.cssText = `
                        position: absolute;
                        top: -30px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: var(--accent);
                        color: var(--bg-primary);
                        padding: 4px 8px;
                        border-radius: 4px;
                        font-size: 12px;
                        white-space: nowrap;
                        z-index: 1000;
                    `;
                    
                    // Create wrapper to position tooltip
                    const wrapper = document.createElement('span');
                    wrapper.style.cssText = 'position: relative; display: inline-block;';
                    codeElement.parentNode.insertBefore(wrapper, codeElement);
                    wrapper.appendChild(codeElement);
                    wrapper.appendChild(tooltip);
                    
                    setTimeout(() => {
                        tooltip.remove();
                        // Unwrap element
                        if (wrapper.parentNode) {
                            wrapper.parentNode.insertBefore(codeElement, wrapper);
                            wrapper.remove();
                        }
                    }, 1000);
                });
            }
        }
        
        // Fallback copy method
        function fallbackCopy(text, codeElement) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess(codeElement);
            } catch (err) {
                console.error('Failed to copy:', err);
            }
            
            document.body.removeChild(textarea);
        }
        
        // Show copy success feedback
        function showCopySuccess(codeElement) {
            const button = codeElement.closest('.code-block-wrapper').querySelector('.copy-button');
            if (button) {
                const originalHTML = button.innerHTML;
                button.classList.add('copied');
                button.innerHTML = `
                    <i data-lucide="check" style="width: 14px; height: 14px;"></i>
                    <span>Copiado!</span>
                `;
                lucide.createIcons();
                
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = originalHTML;
                    lucide.createIcons();
                }, 2000);
            }
        }
        
        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
            lucide.createIcons();
        }
        
        // Font size controls
        let currentFontSize = 18;
        
        function increaseFontSize() {
            if (currentFontSize < 32) {
                currentFontSize += 2;
                applyFontSize();
            }
        }
        
        function decreaseFontSize() {
            if (currentFontSize > 12) {
                currentFontSize -= 2;
                applyFontSize();
            }
        }
        
        function applyFontSize() {
            const contentArea = document.getElementById('contentArea');
            if (contentArea) {
                contentArea.querySelectorAll('p, li').forEach(el => {
                    el.style.fontSize = currentFontSize + 'px';
                });
            }
            localStorage.setItem('fontSize', currentFontSize);
        }
        
        // Search
        function searchChapters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.chapter-item').forEach(item => {
                const title = item.querySelector('.chapter-title').textContent.toLowerCase();
                item.style.display = title.includes(searchTerm) ? 'flex' : 'none';
            });
        }
        
        // Enhanced Voice Over with Optimized Defaults
        let currentUtterance = null;
        let isReading = false;
        let isPaused = false;
        let speechRate = 0.65; // Optimal audiobook speed for Portuguese
        let speechPitch = 0.9; // Natural pitch for narrator voice
        let speechVolume = 1.0;
        let selectedVoice = null;
        let preferredVoiceNames = [
            // Best Brazilian Portuguese voices (in order of preference)
            'Microsoft Maria - Portuguese (Brazil)',
            'Google português do Brasil',
            'Luciana',
            'Felipe', 
            'Fernanda',
            'Daniel',
            'Vitória',
            'Ricardo',
            'Microsoft Daniel - Portuguese (Brazil)',
            'Portuguese Brazil',
            'Brazilian Portuguese'
        ];
        
        // Toggle voice over with better controls
        function toggleVoiceOver() {
            if (!('speechSynthesis' in window)) {
                alert('Narração não suportada neste navegador. Use Chrome ou Edge para melhor experiência.');
                return;
            }
            
            if (isReading) {
                stopReading();
            } else {
                showVoiceOptions();
            }
        }
        
        // Show voice options modal
        function showVoiceOptions() {
            const existingModal = document.getElementById('voiceModal');
            if (existingModal) existingModal.remove();
            
            const modal = document.createElement('div');
            modal.id = 'voiceModal';
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: var(--bg-secondary);
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 24px;
                z-index: 10000;
                box-shadow: 0 10px 40px rgba(0,0,0,0.5);
                max-width: 500px;
                width: 90%;
            `;
            
            // Get available voices and auto-select best one
            const voices = speechSynthesis.getVoices();
            const ptBRVoices = voices.filter(v => v.lang.includes('pt-BR') || v.lang.includes('pt_BR'));
            const ptVoices = voices.filter(v => v.lang.includes('pt') && !v.lang.includes('pt-BR'));
            const otherVoices = voices.filter(v => !v.lang.includes('pt'));
            
            // Auto-select best voice based on preference list
            if (!selectedVoice && voices.length > 0) {
                selectBestVoice(voices);
            }
            
            modal.innerHTML = `
                <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">Configurações do Narrador</h3>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-secondary);">
                        Voz (escolha uma voz brasileira para melhor qualidade):
                    </label>
                    <select id="voiceSelect" style="width: 100%; padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-size: 14px;">
                        ${ptBRVoices.length > 0 ? `
                            <optgroup label="🇧🇷 Português Brasileiro (Recomendado)">
                                ${ptBRVoices.map((v, i) => `
                                    <option value="${voices.indexOf(v)}" ${i === 0 ? 'selected' : ''}>
                                        ${v.name} ${v.localService ? '(Local)' : '(Online)'}
                                    </option>
                                `).join('')}
                            </optgroup>
                        ` : ''}
                        ${ptVoices.length > 0 ? `
                            <optgroup label="🇵🇹 Português">
                                ${ptVoices.map(v => `
                                    <option value="${voices.indexOf(v)}">
                                        ${v.name}
                                    </option>
                                `).join('')}
                            </optgroup>
                        ` : ''}
                        ${otherVoices.length > 0 ? `
                            <optgroup label="🌐 Outras">
                                ${otherVoices.slice(0, 5).map(v => `
                                    <option value="${voices.indexOf(v)}">
                                        ${v.name} (${v.lang})
                                    </option>
                                `).join('')}
                            </optgroup>
                        ` : ''}
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-secondary);">
                        Velocidade: <span id="speedValue">0.65x</span>
                    </label>
                    <input type="range" id="speedRange" min="0.5" max="1.5" step="0.05" value="0.65" 
                           style="width: 100%; height: 6px; background: var(--bg-tertiary); border-radius: 3px; outline: none;">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-secondary);">
                        Tom de Voz: <span id="pitchValue">0.9</span>
                    </label>
                    <input type="range" id="pitchRange" min="0.5" max="2" step="0.1" value="0.9"
                           style="width: 100%; height: 6px; background: var(--bg-tertiary); border-radius: 3px; outline: none;">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-secondary);">
                        Volume: <span id="volumeValue">100%</span>
                    </label>
                    <input type="range" id="volumeRange" min="0" max="1" step="0.1" value="1"
                           style="width: 100%; height: 6px; background: var(--bg-tertiary); border-radius: 3px; outline: none;">
                </div>
                
                <div style="display: flex; gap: 12px;">
                    <button onclick="testVoice()" style="flex: 1; padding: 12px; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                        Testar Voz
                    </button>
                    <button onclick="startReadingWithSettings()" style="flex: 1; padding: 12px; background: var(--accent); color: var(--bg-primary); border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        Iniciar Leitura
                    </button>
                    <button onclick="closeVoiceModal()" style="padding: 12px 20px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                        Cancelar
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('speedRange').addEventListener('input', (e) => {
                speechRate = parseFloat(e.target.value);
                document.getElementById('speedValue').textContent = speechRate.toFixed(2) + 'x';
            });
            
            document.getElementById('pitchRange').addEventListener('input', (e) => {
                speechPitch = parseFloat(e.target.value);
                document.getElementById('pitchValue').textContent = speechPitch.toFixed(1);
            });
            
            document.getElementById('volumeRange').addEventListener('input', (e) => {
                speechVolume = parseFloat(e.target.value);
                document.getElementById('volumeValue').textContent = Math.round(speechVolume * 100) + '%';
            });
            
            // Set default voice
            if (ptBRVoices.length > 0) {
                selectedVoice = ptBRVoices[0];
            }
        }
        
        // Test voice with sample text
        function testVoice() {
            speechSynthesis.cancel();
            
            const voiceSelect = document.getElementById('voiceSelect');
            const voices = speechSynthesis.getVoices();
            selectedVoice = voices[voiceSelect.value];
            
            const testText = "Olá! Esta é uma prévia da voz selecionada. Ajuste a velocidade, tom e volume conforme sua preferência para uma leitura confortável.";
            const utterance = new SpeechSynthesisUtterance(testText);
            
            utterance.voice = selectedVoice;
            utterance.rate = speechRate;
            utterance.pitch = speechPitch;
            utterance.volume = speechVolume;
            utterance.lang = 'pt-BR';
            
            speechSynthesis.speak(utterance);
        }
        
        // Start reading with selected settings
        function startReadingWithSettings() {
            const voiceSelect = document.getElementById('voiceSelect');
            const voices = speechSynthesis.getVoices();
            selectedVoice = voices[voiceSelect.value];
            
            closeVoiceModal();
            startReading();
        }
        
        // Close voice modal
        function closeVoiceModal() {
            const modal = document.getElementById('voiceModal');
            if (modal) modal.remove();
        }
        
        // Start reading
        function startReading() {
            const contentArea = document.getElementById('contentArea');
            const text = contentArea.innerText;
            
            if (!text) {
                alert('Nenhum conteúdo para ler.');
                return;
            }
            
            // Cancel any ongoing speech
            speechSynthesis.cancel();
            
            // Split text into smaller chunks for better control
            const chunks = text.match(/[^.!?]+[.!?]+/g) || [text];
            let currentChunk = 0;
            
            function readNextChunk() {
                if (currentChunk >= chunks.length) {
                    isReading = false;
                    updateVoiceButton();
                    return;
                }
                
                currentUtterance = new SpeechSynthesisUtterance(chunks[currentChunk]);
                
                if (selectedVoice) {
                    currentUtterance.voice = selectedVoice;
                }
                
                currentUtterance.rate = speechRate;
                currentUtterance.pitch = speechPitch;
                currentUtterance.volume = speechVolume;
                currentUtterance.lang = 'pt-BR';
                
                currentUtterance.onend = () => {
                    currentChunk++;
                    if (isReading && !isPaused) {
                        // Small pause between sentences
                        setTimeout(readNextChunk, 200);
                    }
                };
                
                currentUtterance.onerror = (e) => {
                    console.error('Speech error:', e);
                    isReading = false;
                    updateVoiceButton();
                };
                
                speechSynthesis.speak(currentUtterance);
            }
            
            isReading = true;
            updateVoiceButton();
            readNextChunk();
        }
        
        // Stop reading
        function stopReading() {
            speechSynthesis.cancel();
            isReading = false;
            isPaused = false;
            updateVoiceButton();
        }
        
        // Update voice button appearance
        function updateVoiceButton() {
            const btn = document.getElementById('playBtn');
            if (isReading) {
                btn.classList.add('active');
                btn.innerHTML = `
                    <i data-lucide="volume-x" class="w-4 h-4"></i>
                    <span style="margin-left: 8px; font-size: 13px;">Parar</span>
                `;
            } else {
                btn.classList.remove('active');
                btn.innerHTML = `
                    <i data-lucide="volume-2" class="w-4 h-4"></i>
                    <span style="margin-left: 8px; font-size: 13px;">Narrador</span>
                `;
            }
            lucide.createIcons();
        }
        
        // Load voices when available
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = () => {
                const voices = speechSynthesis.getVoices();
                const ptBRVoices = voices.filter(v => v.lang.includes('pt-BR'));
                if (ptBRVoices.length > 0 && !selectedVoice) {
                    selectedVoice = ptBRVoices[0];
                }
            };
        }
        
        // Load saved preferences
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
        }
        
        const savedFontSize = localStorage.getItem('fontSize');
        if (savedFontSize) {
            currentFontSize = parseInt(savedFontSize);
        }
        
        // Content protection (except for code blocks)
        document.addEventListener('contextmenu', e => {
            // Allow right-click on code blocks
            if (e.target.closest('.code-block-wrapper')) return;
            e.preventDefault();
        });
        
        document.addEventListener('copy', e => {
            // Allow copy on code blocks
            if (e.target.closest('.code-block-wrapper') || e.target.closest('.copy-button')) return;
            e.preventDefault();
        });
        
        document.addEventListener('cut', e => e.preventDefault());
        
        // Exercise response system
        function createExerciseArea(exerciseId, prompt) {
            return `
                <div class="exercise-area" style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: var(--accent); margin-bottom: 12px; font-size: 16px; font-weight: 600;">
                        <i data-lucide="edit-3" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>
                        Exercício
                    </h4>
                    <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">${prompt}</p>
                    <textarea 
                        id="exercise-${exerciseId}" 
                        placeholder="Digite sua resposta aqui..."
                        style="width: 100%; min-height: 120px; padding: 12px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; font-family: inherit; font-size: 14px; resize: vertical;"
                        onchange="saveExerciseResponse('${exerciseId}', this.value)"
                    ></textarea>
                    <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <span id="save-status-${exerciseId}" style="color: var(--text-secondary); font-size: 12px;"></span>
                        <button onclick="clearExercise('${exerciseId}')" style="padding: 8px 16px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px;">
                            Limpar
                        </button>
                    </div>
                </div>
            `;
        }
        
        function saveExerciseResponse(exerciseId, value) {
            localStorage.setItem(`exercise-${exerciseId}`, value);
            const statusEl = document.getElementById(`save-status-${exerciseId}`);
            if (statusEl) {
                statusEl.textContent = 'Resposta salva automaticamente';
                setTimeout(() => {
                    statusEl.textContent = '';
                }, 2000);
            }
        }
        
        function loadExerciseResponse(exerciseId) {
            const saved = localStorage.getItem(`exercise-${exerciseId}`);
            if (saved) {
                const textarea = document.getElementById(`exercise-${exerciseId}`);
                if (textarea) textarea.value = saved;
            }
        }
        
        function clearExercise(exerciseId) {
            if (confirm('Tem certeza que deseja limpar sua resposta?')) {
                localStorage.removeItem(`exercise-${exerciseId}`);
                const textarea = document.getElementById(`exercise-${exerciseId}`);
                if (textarea) textarea.value = '';
            }
        }
        
        // Quiz system with advanced questions
        const quizQuestions = [
            {
                question: "O que é Cultura Builder segundo o livro?",
                options: [
                    "Uma empresa de tecnologia",
                    "Um movimento de transformação através da tecnologia e IA",
                    "Um curso online de programação",
                    "Uma ferramenta de inteligência artificial"
                ],
                correct: 1,
                explanation: "Cultura Builder é um movimento de transformação que combina tecnologia, IA e mentalidade empreendedora para criar um novo Brasil."
            },
            {
                question: "Qual a principal mensagem sobre o futuro do trabalho?",
                options: [
                    "Todos serão substituídos por IA",
                    "A tecnologia não afetará os empregos",
                    "Quem souber usar IA terá vantagem sobre quem não souber",
                    "Apenas programadores terão emprego"
                ],
                correct: 2,
                explanation: "O livro enfatiza que não é a IA que vai substituir você, mas sim alguém que sabe usar IA."
            },
            {
                question: "O que significa ser um 'Builder'?",
                options: [
                    "Ser um programador profissional",
                    "Construir casas e edifícios",
                    "Criar soluções e transformar ideias em realidade usando tecnologia",
                    "Trabalhar em uma startup"
                ],
                correct: 2,
                explanation: "Um Builder é alguém que constrói o futuro, transformando ideias em realidade através da tecnologia e IA."
            },
            {
                question: "Qual ferramenta de IA é apresentada no Capítulo 34?",
                options: [
                    "ChatGPT",
                    "Claude Code",
                    "GitHub Copilot",
                    "Google Gemini"
                ],
                correct: 1,
                explanation: "O Capítulo 34 ensina como instalar e usar o Claude Code, ferramenta que permite programar conversando em português."
            },
            {
                question: "Segundo o livro, qual é a barreira que caiu com a IA?",
                options: [
                    "A barreira financeira",
                    "A barreira geográfica",
                    "A barreira do inglês e do código",
                    "A barreira educacional"
                ],
                correct: 2,
                explanation: "A IA derrubou a barreira do inglês e do código, permitindo que qualquer pessoa crie tecnologia em português."
            },
            {
                question: "Como o livro sugere lidar com a resistência à mudança tecnológica?",
                options: [
                    "Ignorar quem resiste e seguir em frente",
                    "Forçar a adoção imediata de todas as tecnologias",
                    "Demonstrar valor gradualmente e educar com paciência",
                    "Desistir de tentar mudar"
                ],
                correct: 2,
                explanation: "O livro recomenda uma abordagem gradual, demonstrando valor e educando com paciência para superar resistências."
            },
            {
                question: "Qual é a estratégia recomendada para monetizar habilidades de IA?",
                options: [
                    "Focar apenas em grandes empresas",
                    "Começar com projetos pequenos e escalar gradualmente",
                    "Esperar ter conhecimento perfeito antes de cobrar",
                    "Trabalhar apenas de graça para ganhar experiência"
                ],
                correct: 1,
                explanation: "O livro sugere começar com projetos menores (R$ 500-1.500) e escalar gradualmente conforme ganha experiência."
            },
            {
                question: "O que é LGPD e por que é importante para Builders?",
                options: [
                    "Lei Geral de Proteção de Dados - fundamental para compliance",
                    "Uma certificação opcional para desenvolvedores",
                    "Um framework de programação",
                    "Uma linguagem de programação brasileira"
                ],
                correct: 0,
                explanation: "LGPD é a Lei Geral de Proteção de Dados, essencial para qualquer Builder que trabalhe com dados de usuários."
            },
            {
                question: "Qual é o conceito de 'Stack Overflow brasileiro' e sua importância?",
                options: [
                    "Copiar soluções americanas sem adaptação",
                    "Criar soluções locais adaptadas à realidade brasileira",
                    "Um site de programação em português",
                    "Traduzir conteúdo estrangeiro"
                ],
                correct: 1,
                explanation: "Representa a oportunidade de criar versões brasileiras de sucessos globais, considerando nossa cultura e necessidades específicas."
            },
            {
                question: "Segundo o livro, qual é a principal vantagem competitiva do Brasil na era da IA?",
                options: [
                    "Mão de obra barata",
                    "Infraestrutura tecnológica avançada",
                    "Criatividade, adaptabilidade e o 'jeitinho brasileiro' aplicado à inovação",
                    "Investimentos governamentais massivos"
                ],
                correct: 2,
                explanation: "O livro destaca nossa criatividade natural e capacidade de adaptação como diferenciais na era da IA."
            },
            {
                question: "Como o livro sugere abordar a ética no desenvolvimento com IA?",
                options: [
                    "Ética não é relevante se o produto funciona",
                    "Seguir apenas regulamentações legais mínimas",
                    "Implementar avaliação contínua de impacto e valores",
                    "Deixar a ética para depois do lançamento"
                ],
                correct: 2,
                explanation: "O livro enfatiza a importância de avaliar continuamente o impacto ético e alinhar com valores humanos."
            },
            {
                question: "Qual é a visão do livro sobre comunidades de Builders?",
                options: [
                    "Competição acirrada entre membros",
                    "Colaboração e compartilhamento de conhecimento",
                    "Isolamento para proteger ideias",
                    "Apenas networking superficial"
                ],
                correct: 1,
                explanation: "O livro promove comunidades colaborativas onde Builders compartilham conhecimento e crescem juntos."
            },
            {
                question: "Como o Claude Code diferencia-se de outras ferramentas de IA para programação?",
                options: [
                    "É mais barato que as alternativas",
                    "Cria projetos completos através de conversação em português",
                    "Só funciona para Python",
                    "Requer conhecimento avançado de programação"
                ],
                correct: 1,
                explanation: "Claude Code permite criar projetos completos conversando em português, diferente de ferramentas que apenas sugerem código."
            },
            {
                question: "Qual é a importância do 'Momento Sputnik' mencionado no livro?",
                options: [
                    "Marca o início da corrida espacial",
                    "Representa um ponto de virada tecnológica irreversível",
                    "É apenas uma metáfora sem importância",
                    "Refere-se ao lançamento de um satélite brasileiro"
                ],
                correct: 1,
                explanation: "O 'Momento Sputnik' representa pontos de virada tecnológica que mudam permanentemente o cenário competitivo."
            },
            {
                question: "Segundo o livro, qual deve ser a postura de um Builder diante do fracasso?",
                options: [
                    "Evitar riscos para nunca fracassar",
                    "Esconder fracassos da comunidade",
                    "Ver fracassos como aprendizados essenciais para evolução",
                    "Desistir após o primeiro fracasso"
                ],
                correct: 2,
                explanation: "O livro promove uma mentalidade onde fracassos são vistos como aprendizados valiosos no caminho do Builder."
            }
        ];
        
        let currentQuestion = 0;
        let score = 0;
        let answeredQuestions = new Set();
        
        function createQuiz() {
            return `
                <div id="quiz-container" style="background: var(--bg-secondary); border: 2px solid var(--accent); border-radius: 16px; padding: 32px; margin: 40px 0;">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, var(--accent), #00ff88); border-radius: 8px;">
                            <span style="color: var(--bg-primary); font-weight: 800; font-size: 20px; letter-spacing: 2px;">CULTURA BUILDER</span>
                        </div>
                    </div>
                    <h2 style="color: var(--text-primary); margin-bottom: 8px; text-align: center; font-size: 28px; font-weight: 700;">
                        Teste de Conhecimento Builder
                    </h2>
                    <p style="text-align: center; color: var(--text-secondary); font-size: 14px; margin-bottom: 24px;">
                        Avaliação Final do Manuscrito
                    </p>
                    <div id="quiz-content">
                        <div style="text-align: center; padding: 20px;">
                            <div style="background: var(--bg-tertiary); border-radius: 12px; padding: 24px; margin-bottom: 24px;">
                                <p style="font-size: 16px; color: var(--text-primary); margin-bottom: 16px;">
                                    <strong>Teste seu domínio dos conceitos fundamentais da Cultura Builder</strong>
                                </p>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; max-width: 400px; margin: 0 auto;">
                                    <div style="text-align: left;">
                                        <p style="color: var(--accent); font-size: 14px; margin-bottom: 4px;">📝 Questões</p>
                                        <p style="color: var(--text-primary); font-size: 20px; font-weight: 600;">15</p>
                                    </div>
                                    <div style="text-align: left;">
                                        <p style="color: var(--accent); font-size: 14px; margin-bottom: 4px;">🎯 Aprovação</p>
                                        <p style="color: var(--text-primary); font-size: 20px; font-weight: 600;">70%</p>
                                    </div>
                                    <div style="text-align: left;">
                                        <p style="color: var(--accent); font-size: 14px; margin-bottom: 4px;">⏱️ Tempo</p>
                                        <p style="color: var(--text-primary); font-size: 20px; font-weight: 600;">Livre</p>
                                    </div>
                                    <div style="text-align: left;">
                                        <p style="color: var(--accent); font-size: 14px; margin-bottom: 4px;">🏆 Certificado</p>
                                        <p style="color: var(--text-primary); font-size: 20px; font-weight: 600;">Sim</p>
                                    </div>
                                </div>
                            </div>
                            <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 24px;">
                                Ao completar com 70% ou mais, você receberá um certificado de conclusão personalizado
                            </p>
                            <button onclick="startQuiz()" style="padding: 16px 32px; background: linear-gradient(135deg, var(--accent), #00ff88); color: var(--bg-primary); border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.2s;">
                                Iniciar Avaliação
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function startQuiz() {
            currentQuestion = 0;
            score = 0;
            answeredQuestions = new Set();
            showQuestion();
        }
        
        function showQuestion() {
            const q = quizQuestions[currentQuestion];
            const quizContent = document.getElementById('quiz-content');
            
            quizContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <span style="color: var(--text-secondary); font-size: 14px;">Pergunta ${currentQuestion + 1} de ${quizQuestions.length}</span>
                    <div style="background: var(--bg-tertiary); height: 8px; border-radius: 4px; margin-top: 8px; overflow: hidden;">
                        <div style="background: var(--accent); height: 100%; width: ${((currentQuestion + 1) / quizQuestions.length) * 100}%; transition: width 0.3s;"></div>
                    </div>
                </div>
                
                <h3 style="font-size: 20px; color: var(--text-primary); margin-bottom: 24px;">${q.question}</h3>
                
                <div id="quiz-options" style="display: flex; flex-direction: column; gap: 12px;">
                    ${q.options.map((option, index) => `
                        <button 
                            onclick="selectAnswer(${index})" 
                            class="quiz-option"
                            style="padding: 16px; background: var(--bg-tertiary); color: var(--text-primary); border: 2px solid var(--border); border-radius: 8px; text-align: left; cursor: pointer; transition: all 0.2s;">
                            <span style="display: inline-block; width: 32px; height: 32px; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 50%; text-align: center; line-height: 32px; margin-right: 12px; font-weight: 600;">
                                ${String.fromCharCode(65 + index)}
                            </span>
                            ${option}
                        </button>
                    `).join('')}
                </div>
                
                <div id="quiz-feedback" style="margin-top: 24px;"></div>
            `;
        }
        
        function selectAnswer(index) {
            if (answeredQuestions.has(currentQuestion)) return;
            
            answeredQuestions.add(currentQuestion);
            const q = quizQuestions[currentQuestion];
            const isCorrect = index === q.correct;
            
            if (isCorrect) score++;
            
            // Visual feedback
            const options = document.querySelectorAll('.quiz-option');
            options[index].style.border = isCorrect ? '2px solid #00ff88' : '2px solid #ff4444';
            options[index].style.background = isCorrect ? 'rgba(0, 255, 136, 0.1)' : 'rgba(255, 68, 68, 0.1)';
            options[q.correct].style.border = '2px solid #00ff88';
            options[q.correct].style.background = 'rgba(0, 255, 136, 0.1)';
            
            // Disable all options
            options.forEach(opt => opt.style.pointerEvents = 'none');
            
            // Show feedback
            const feedbackDiv = document.getElementById('quiz-feedback');
            feedbackDiv.innerHTML = `
                <div style="padding: 16px; background: ${isCorrect ? 'rgba(0, 255, 136, 0.1)' : 'rgba(255, 68, 68, 0.1)'}; border: 1px solid ${isCorrect ? '#00ff88' : '#ff4444'}; border-radius: 8px;">
                    <p style="font-weight: 600; color: ${isCorrect ? '#00ff88' : '#ff4444'}; margin-bottom: 8px;">
                        ${isCorrect ? '✓ Correto!' : '✗ Incorreto'}
                    </p>
                    <p style="color: var(--text-secondary); font-size: 14px;">${q.explanation}</p>
                </div>
                
                <button 
                    onclick="${currentQuestion < quizQuestions.length - 1 ? 'nextQuestion()' : 'showResults()'}"
                    style="margin-top: 20px; padding: 12px 24px; background: var(--accent); color: var(--bg-primary); border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    ${currentQuestion < quizQuestions.length - 1 ? 'Próxima Pergunta' : 'Ver Resultados'}
                </button>
            `;
        }
        
        function nextQuestion() {
            currentQuestion++;
            showQuestion();
        }
        
        function showResults() {
            const percentage = (score / quizQuestions.length) * 100;
            const passed = percentage >= 70; // 70% para passar
            let message;
            
            if (percentage === 100) {
                message = "Perfeito! Você domina completamente os conceitos da Cultura Builder!";
            } else if (percentage >= 90) {
                message = "Excelente! Você tem um domínio excepcional do conteúdo!";
            } else if (percentage >= 80) {
                message = "Muito bom! Você entendeu muito bem os conceitos!";
            } else if (percentage >= 70) {
                message = "Parabéns! Você passou no teste e está pronto para ser um Builder!";
            } else if (percentage >= 60) {
                message = "Quase lá! Revise alguns conceitos e tente novamente.";
            } else {
                message = "Continue estudando! A jornada Builder requer dedicação.";
            }
            
            const quizContent = document.getElementById('quiz-content');
            quizContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="margin-bottom: 24px;">
                        <div style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, var(--accent), #00ff88); border-radius: 8px;">
                            <span style="color: var(--bg-primary); font-weight: 800; font-size: 20px; letter-spacing: 2px;">CULTURA BUILDER</span>
                        </div>
                    </div>
                    
                    <h3 style="font-size: 32px; color: var(--accent); margin-bottom: 16px;">
                        ${score} de ${quizQuestions.length}
                    </h3>
                    
                    <div style="background: var(--bg-tertiary); height: 20px; border-radius: 10px; margin: 24px auto; max-width: 300px; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, var(--accent), #00ff88); height: 100%; width: ${percentage}%; transition: width 1s;"></div>
                    </div>
                    
                    <p style="font-size: 16px; color: var(--text-secondary); margin-bottom: 8px;">
                        ${percentage.toFixed(0)}% de acerto
                    </p>
                    
                    <p style="font-size: 18px; color: var(--text-primary); margin-bottom: 32px;">${message}</p>
                    
                    ${passed ? `
                        <div style="background: rgba(0, 255, 136, 0.1); border: 2px solid #00ff88; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                            <p style="color: #00ff88; font-size: 20px; font-weight: 600; margin-bottom: 12px;">
                                🎓 Parabéns, Builder!
                            </p>
                            <p style="color: var(--text-primary); font-size: 14px;">
                                Você completou com sucesso o Quiz do Manuscrito Cultura Builder!
                            </p>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
                        ${passed ? `
                            <button onclick="generateCertificate()" style="padding: 12px 24px; background: linear-gradient(135deg, #00ff88, var(--accent)); color: var(--bg-primary); border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                <i data-lucide="download" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 8px;"></i>
                                Baixar Certificado
                            </button>
                        ` : ''}
                        <button onclick="startQuiz()" style="padding: 12px 24px; background: var(--accent); color: var(--bg-primary); border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            ${passed ? 'Refazer Quiz' : 'Tentar Novamente'}
                        </button>
                        <button onclick="shareResults()" style="padding: 12px 24px; background: transparent; color: var(--accent); border: 2px solid var(--accent); border-radius: 8px; font-weight: 600; cursor: pointer;">
                            Compartilhar
                        </button>
                    </div>
                </div>
            `;
            
            // Update icons
            lucide.createIcons();
            
            // Save completion if passed
            if (passed) {
                localStorage.setItem('quizCompleted', 'true');
                localStorage.setItem('quizScore', score.toString());
                localStorage.setItem('quizDate', new Date().toISOString());
            }
        }
        
        function shareResults() {
            const percentage = (score / quizQuestions.length) * 100;
            const text = `Completei o Quiz do Manuscrito Cultura Builder com ${percentage.toFixed(0)}% de acerto! 🚀 #CulturaBuilder`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Quiz Cultura Builder',
                    text: text
                });
            } else {
                // Fallback to copy to clipboard
                navigator.clipboard.writeText(text);
                alert('Resultado copiado para a área de transferência!');
            }
        }
        
        // Generate certificate
        function generateCertificate() {
            const userName = prompt('Digite seu nome completo para o certificado:');
            if (!userName) return;
            
            const canvas = document.createElement('canvas');
            canvas.width = 1920;
            canvas.height = 1080;
            const ctx = canvas.getContext('2d');
            
            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#0a0a0a');
            gradient.addColorStop(1, '#1a1a1a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Border with gradient
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 8;
            ctx.strokeRect(40, 40, canvas.width - 80, canvas.height - 80);
            
            // Inner border
            ctx.strokeStyle = '#00ff8830';
            ctx.lineWidth = 2;
            ctx.strokeRect(60, 60, canvas.width - 120, canvas.height - 120);
            
            // Title - CERTIFICADO
            ctx.fillStyle = '#00ff88';
            ctx.font = 'bold 72px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('CERTIFICADO', canvas.width / 2, 200);
            
            // Subtitle - DE CONCLUSÃO
            ctx.fillStyle = '#ffffff';
            ctx.font = '36px sans-serif';
            ctx.fillText('DE CONCLUSÃO', canvas.width / 2, 260);
            
            // Culture Builder Logo/Text
            ctx.fillStyle = '#00ff88';
            ctx.font = 'bold 48px sans-serif';
            ctx.fillText('CULTURA BUILDER', canvas.width / 2, 350);
            
            // Certificate text
            ctx.fillStyle = '#cccccc';
            ctx.font = '28px sans-serif';
            ctx.fillText('Certificamos que', canvas.width / 2, 450);
            
            // User name
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 56px sans-serif';
            ctx.fillText(userName.toUpperCase(), canvas.width / 2, 530);
            
            // Completion text
            ctx.fillStyle = '#cccccc';
            ctx.font = '28px sans-serif';
            const lines = [
                'completou com sucesso o Quiz do Manuscrito Cultura Builder',
                `com ${((score / quizQuestions.length) * 100).toFixed(0)}% de aproveitamento,`,
                'demonstrando domínio dos conceitos fundamentais',
                'para se tornar um Builder na era da Inteligência Artificial.'
            ];
            
            lines.forEach((line, index) => {
                ctx.fillText(line, canvas.width / 2, 620 + (index * 50));
            });
            
            // Date
            const date = new Date();
            const dateStr = date.toLocaleDateString('pt-BR', { 
                day: '2-digit', 
                month: 'long', 
                year: 'numeric' 
            });
            ctx.fillStyle = '#888888';
            ctx.font = '24px sans-serif';
            ctx.fillText(dateStr, canvas.width / 2, 880);
            
            // Signature line
            ctx.strokeStyle = '#444444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2 - 200, 950);
            ctx.lineTo(canvas.width / 2 + 200, 950);
            ctx.stroke();
            
            // Signature text
            ctx.fillStyle = '#888888';
            ctx.font = '20px sans-serif';
            ctx.fillText('Bruno Pessôa', canvas.width / 2, 980);
            ctx.fillText('Autor - Manuscrito Cultura Builder', canvas.width / 2, 1010);
            
            // Decorative elements
            ctx.strokeStyle = '#00ff8820';
            ctx.lineWidth = 1;
            
            // Top left corner decoration
            ctx.beginPath();
            ctx.moveTo(100, 100);
            ctx.lineTo(200, 100);
            ctx.moveTo(100, 100);
            ctx.lineTo(100, 200);
            ctx.stroke();
            
            // Top right corner
            ctx.beginPath();
            ctx.moveTo(canvas.width - 100, 100);
            ctx.lineTo(canvas.width - 200, 100);
            ctx.moveTo(canvas.width - 100, 100);
            ctx.lineTo(canvas.width - 100, 200);
            ctx.stroke();
            
            // Bottom left corner
            ctx.beginPath();
            ctx.moveTo(100, canvas.height - 100);
            ctx.lineTo(200, canvas.height - 100);
            ctx.moveTo(100, canvas.height - 100);
            ctx.lineTo(100, canvas.height - 200);
            ctx.stroke();
            
            // Bottom right corner
            ctx.beginPath();
            ctx.moveTo(canvas.width - 100, canvas.height - 100);
            ctx.lineTo(canvas.width - 200, canvas.height - 100);
            ctx.moveTo(canvas.width - 100, canvas.height - 100);
            ctx.lineTo(canvas.width - 100, canvas.height - 200);
            ctx.stroke();
            
            // Add hashtag
            ctx.fillStyle = '#00ff88';
            ctx.font = 'bold 24px sans-serif';
            ctx.fillText('#CulturaBuilder', canvas.width - 200, canvas.height - 60);
            
            // Convert to image and download
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `certificado-cultura-builder-${userName.replace(/\s+/g, '-').toLowerCase()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 'image/png');
        }
        
        document.addEventListener('cut', e => e.preventDefault());
    </script>
</body>
</html>