<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brazilian Fan Token Dashboard - Real Chiliz Data</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ef4444;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: #10b981;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .connection-panel {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
        }

        .connection-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .connection-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .connection-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .connection-card.active {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .connection-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .connection-card p {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .data-section {
            padding: 30px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .success-message.active {
            display: block;
        }

        .token-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .token-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .token-card h4 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #1f2937;
        }

        .token-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .token-stat label {
            color: #6b7280;
            font-size: 13px;
        }

        .token-stat span {
            font-weight: 600;
            color: #1f2937;
        }

        .charts-section {
            padding: 30px;
            display: none;
        }

        .charts-section.active {
            display: block;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .info-box {
            background: #f0f9ff;
            border: 1px solid #0369a1;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #0369a1;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #0c4a6e;
            font-size: 14px;
            line-height: 1.5;
        }

        .rpc-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .rpc-endpoint {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rpc-endpoint .status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6b7280;
        }

        .rpc-endpoint.checking .status {
            background: #fbbf24;
        }

        .rpc-endpoint.online .status {
            background: #10b981;
        }

        .rpc-endpoint.offline .status {
            background: #ef4444;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1>âš½ Brazilian Fan Token Dashboard - Real Blockchain Data</h1>
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="connectionStatus">Disconnected</span>
            </div>
        </div>

        <!-- Connection Panel -->
        <div class="connection-panel">
            <h2 style="margin-bottom: 10px;">Choose Connection Method</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">Select how you want to connect to the Chiliz blockchain</p>
            
            <div class="connection-options">
                <!-- MetaMask Connection -->
                <div class="connection-card" id="metamaskCard">
                    <h3>
                        ðŸ¦Š MetaMask Wallet
                    </h3>
                    <p>Connect using MetaMask browser extension for secure, direct blockchain access</p>
                    <button class="btn" onclick="connectMetaMask()">Connect MetaMask</button>
                </div>

                <!-- Direct RPC Connection -->
                <div class="connection-card" id="rpcCard">
                    <h3>
                        ðŸ”— Direct RPC Connection
                    </h3>
                    <p>Connect directly to Chiliz public RPC endpoints (read-only access)</p>
                    <button class="btn" onclick="connectRPC()">Connect to RPC</button>
                </div>

                <!-- API Connection -->
                <div class="connection-card" id="apiCard">
                    <h3>
                        ðŸ“¡ Chiliscan API
                    </h3>
                    <p>Use Chiliscan block explorer API for aggregated data</p>
                    <button class="btn" onclick="connectAPI()">Use Explorer API</button>
                </div>
            </div>

            <!-- RPC Status -->
            <div class="rpc-status" id="rpcStatus" style="display: none;">
                <div class="rpc-endpoint" id="rpc1">
                    <div class="status"></div>
                    <span>rpc.ankr.com/chiliz</span>
                </div>
                <div class="rpc-endpoint" id="rpc2">
                    <div class="status"></div>
                    <span>chiliz.publicnode.com</span>
                </div>
                <div class="rpc-endpoint" id="rpc3">
                    <div class="status"></div>
                    <span>chiliz-mainnet.gateway.tatum.io</span>
                </div>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
        </div>

        <!-- Loading Section -->
        <div class="loading" id="loadingSection">
            <div class="spinner"></div>
            <p>Fetching blockchain data...</p>
        </div>

        <!-- Data Section -->
        <div class="data-section" id="dataSection" style="display: none;">
            <h2 style="margin-bottom: 20px;">Live Token Data</h2>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('overview')">Overview</button>
                <button class="tab" onclick="switchTab('transfers')">Recent Transfers</button>
                <button class="tab" onclick="switchTab('holders')">Holder Analysis</button>
                <button class="tab" onclick="switchTab('contracts')">Contract Info</button>
            </div>

            <div id="overview" class="tab-content">
                <div class="info-box">
                    <h4>ðŸ“Š Real-Time Data</h4>
                    <p>Connected to Chiliz Chain (ID: 88888). Data is fetched directly from the blockchain.</p>
                </div>

                <div class="token-grid" id="tokenGrid">
                    <!-- Token cards will be populated here -->
                </div>
            </div>

            <div id="transfers" class="tab-content" style="display: none;">
                <h3>Recent Transfer Events</h3>
                <div id="transfersList"></div>
            </div>

            <div id="holders" class="tab-content" style="display: none;">
                <h3>Token Holder Distribution</h3>
                <canvas id="holdersChart"></canvas>
            </div>

            <div id="contracts" class="tab-content" style="display: none;">
                <h3>Smart Contract Information</h3>
                <div id="contractInfo"></div>
            </div>

            <div style="margin-top: 30px;">
                <button class="btn" onclick="refreshData()">ðŸ”„ Refresh Data</button>
                <button class="btn" onclick="exportData()">ðŸ“¥ Export to CSV</button>
                <button class="btn" onclick="disconnect()">ðŸ”Œ Disconnect</button>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section" id="chartsSection">
            <div class="chart-container">
                <h3>Trading Volume (Last 24h)</h3>
                <canvas id="volumeChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Brazilian Fan Token Configuration
        const TOKENS = {
            MENGO: {
                address: '0xd1723eb9e7c6ee7c7e2d421b2758dc0f2166eddc',
                name: 'Flamengo',
                symbol: 'MENGO',
                color: '#E3002D'
            },
            SCCP: {
                address: '0x20BFeab58f8bE903753d037Ba7e307fc77c97388',
                name: 'Corinthians',
                symbol: 'SCCP',
                color: '#000000'
            },
            VERDAO: {
                address: '0x971364Ec452958d4D65Ba8D508FAa226d7117279',
                name: 'Palmeiras',
                symbol: 'VERDAO',
                color: '#006437'
            },
            FLU: {
                address: '0x86930777d43605C40bA786F7802778ff5413eFaB',
                name: 'Fluminense',
                symbol: 'FLU',
                color: '#862938'
            },
            BAHIA: {
                address: '0xE92e152fC0ff1368739670a5175175154Ceeef42',
                name: 'Bahia',
                symbol: 'BAHIA',
                color: '#006CB5'
            },
            MIBR: {
                address: '0xa8206Af1e6a0289156d45B9d60e5bbD5d1fCf68d',
                name: 'MIBR',
                symbol: 'MIBR',
                color: '#FFD700'
            },
            VASCO: {
                address: '0x689dee82d191dac845599f46393c2efe4b5896a2',
                name: 'Vasco da Gama',
                symbol: 'VASCO',
                color: '#000000'
            }
        };

        // ERC20 ABI for fan tokens
        const ERC20_ABI = [
            'function name() view returns (string)',
            'function symbol() view returns (string)',
            'function totalSupply() view returns (uint256)',
            'function balanceOf(address) view returns (uint256)',
            'function decimals() view returns (uint8)',
            'event Transfer(address indexed from, address indexed to, uint256 value)'
        ];

        // Global variables
        let provider = null;
        let contracts = {};
        let connectionType = null;
        let tokenData = {};

        // RPC Endpoints
        const RPC_ENDPOINTS = [
            'https://rpc.ankr.com/chiliz',
            'https://chiliz.publicnode.com',
            'https://chiliz-mainnet.gateway.tatum.io'
        ];

        // Connect via MetaMask
        async function connectMetaMask() {
            if (typeof window.ethereum === 'undefined') {
                showError('MetaMask is not installed. Please install it to continue.');
                return;
            }

            try {
                showLoading(true);
                
                // Request account access
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                // Create Web3 Provider
                provider = new ethers.providers.Web3Provider(window.ethereum);
                
                // Check if on Chiliz network
                const network = await provider.getNetwork();
                if (network.chainId !== 88888) {
                    // Try to switch to Chiliz
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x15B38' }] // 88888 in hex
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            // Add Chiliz network
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: '0x15B38',
                                    chainName: 'Chiliz Chain Mainnet',
                                    nativeCurrency: {
                                        name: 'CHZ',
                                        symbol: 'CHZ',
                                        decimals: 18
                                    },
                                    rpcUrls: ['https://rpc.ankr.com/chiliz'],
                                    blockExplorerUrls: ['https://chiliscan.com']
                                }]
                            });
                        } else {
                            throw switchError;
                        }
                    }
                }
                
                connectionType = 'metamask';
                await initializeContracts();
                showSuccess('Connected to Chiliz via MetaMask!');
                updateConnectionStatus('MetaMask Connected', true);
                document.getElementById('metamaskCard').classList.add('active');
                
                await fetchTokenData();
                
            } catch (error) {
                showError('Failed to connect MetaMask: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Connect via direct RPC
        async function connectRPC() {
            try {
                showLoading(true);
                document.getElementById('rpcStatus').style.display = 'grid';
                
                // Test RPC endpoints
                let connectedRPC = null;
                for (let i = 0; i < RPC_ENDPOINTS.length; i++) {
                    const endpoint = RPC_ENDPOINTS[i];
                    const statusEl = document.getElementById(`rpc${i + 1}`);
                    statusEl.classList.add('checking');
                    
                    try {
                        const testProvider = new ethers.providers.JsonRpcProvider(endpoint);
                        const blockNumber = await testProvider.getBlockNumber();
                        
                        if (blockNumber > 0) {
                            statusEl.classList.remove('checking');
                            statusEl.classList.add('online');
                            
                            if (!connectedRPC) {
                                connectedRPC = endpoint;
                                provider = testProvider;
                            }
                        }
                    } catch (error) {
                        statusEl.classList.remove('checking');
                        statusEl.classList.add('offline');
                    }
                }
                
                if (!provider) {
                    throw new Error('No RPC endpoints available');
                }
                
                connectionType = 'rpc';
                await initializeContracts();
                showSuccess(`Connected to Chiliz via RPC: ${connectedRPC}`);
                updateConnectionStatus('RPC Connected', true);
                document.getElementById('rpcCard').classList.add('active');
                
                await fetchTokenData();
                
            } catch (error) {
                showError('Failed to connect to RPC: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Connect via API (simplified for demo)
        async function connectAPI() {
            try {
                showLoading(true);
                
                // For demo purposes, we'll use a mock API response
                // In production, you would call the actual Chiliscan API
                connectionType = 'api';
                
                showSuccess('Connected to Chiliscan API (Demo Mode)');
                updateConnectionStatus('API Connected', true);
                document.getElementById('apiCard').classList.add('active');
                
                // Fetch mock data for demo
                await fetchMockAPIData();
                
            } catch (error) {
                showError('Failed to connect to API: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Initialize token contracts
        async function initializeContracts() {
            for (const [symbol, token] of Object.entries(TOKENS)) {
                contracts[symbol] = new ethers.Contract(
                    token.address,
                    ERC20_ABI,
                    provider
                );
            }
        }

        // Fetch token data from blockchain
        async function fetchTokenData() {
            showLoading(true);
            document.getElementById('dataSection').style.display = 'block';
            
            const grid = document.getElementById('tokenGrid');
            grid.innerHTML = '';
            
            for (const [symbol, token] of Object.entries(TOKENS)) {
                try {
                    const contract = contracts[symbol];
                    
                    // Fetch basic token info
                    const [totalSupply, decimals] = await Promise.all([
                        contract.totalSupply(),
                        contract.decimals()
                    ]);
                    
                    // Get recent transfers (last 100 blocks)
                    const currentBlock = await provider.getBlockNumber();
                    const filter = contract.filters.Transfer();
                    const events = await contract.queryFilter(
                        filter,
                        currentBlock - 100,
                        currentBlock
                    );
                    
                    // Calculate volume
                    let volume = ethers.BigNumber.from(0);
                    events.forEach(event => {
                        volume = volume.add(event.args.value);
                    });
                    
                    // Create token card
                    const card = document.createElement('div');
                    card.className = 'token-card';
                    card.innerHTML = `
                        <h4 style="color: ${token.color}">${token.name} (${symbol})</h4>
                        <div class="token-stat">
                            <label>Total Supply:</label>
                            <span>${ethers.utils.formatUnits(totalSupply, decimals)}</span>
                        </div>
                        <div class="token-stat">
                            <label>Recent Transfers:</label>
                            <span>${events.length}</span>
                        </div>
                        <div class="token-stat">
                            <label>24h Volume:</label>
                            <span>${ethers.utils.formatUnits(volume, decimals)} ${symbol}</span>
                        </div>
                        <div class="token-stat">
                            <label>Contract:</label>
                            <span style="font-size: 11px;">${token.address.slice(0, 6)}...${token.address.slice(-4)}</span>
                        </div>
                    `;
                    grid.appendChild(card);
                    
                    // Store data for charts
                    tokenData[symbol] = {
                        totalSupply: totalSupply.toString(),
                        volume: volume.toString(),
                        transfers: events.length,
                        events: events
                    };
                    
                } catch (error) {
                    console.error(`Error fetching ${symbol} data:`, error);
                }
            }
            
            showLoading(false);
            document.getElementById('chartsSection').classList.add('active');
            updateCharts();
        }

        // Fetch mock API data for demo
        async function fetchMockAPIData() {
            document.getElementById('dataSection').style.display = 'block';
            const grid = document.getElementById('tokenGrid');
            grid.innerHTML = '';
            
            // Generate mock data
            for (const [symbol, token] of Object.entries(TOKENS)) {
                const card = document.createElement('div');
                card.className = 'token-card';
                card.innerHTML = `
                    <h4 style="color: ${token.color}">${token.name} (${symbol})</h4>
                    <div class="token-stat">
                        <label>Total Supply:</label>
                        <span>${(Math.random() * 30000000).toFixed(0)}</span>
                    </div>
                    <div class="token-stat">
                        <label>Holders:</label>
                        <span>${(Math.random() * 30000).toFixed(0)}</span>
                    </div>
                    <div class="token-stat">
                        <label>24h Volume:</label>
                        <span>${(Math.random() * 1000000).toFixed(0)} CHZ</span>
                    </div>
                    <div class="token-stat">
                        <label>Price:</label>
                        <span>R$ ${(Math.random() * 10).toFixed(2)}</span>
                    </div>
                `;
                grid.appendChild(card);
            }
            
            document.getElementById('chartsSection').classList.add('active');
        }

        // Update charts
        function updateCharts() {
            // This would create real charts with the fetched data
            console.log('Token data for charts:', tokenData);
        }

        // Utility functions
        function showLoading(show) {
            document.getElementById('loadingSection').classList.toggle('active', show);
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('active');
            setTimeout(() => errorEl.classList.remove('active'), 5000);
        }

        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.classList.add('active');
            setTimeout(() => successEl.classList.remove('active'), 5000);
        }

        function updateConnectionStatus(status, connected) {
            document.getElementById('connectionStatus').textContent = status;
            document.getElementById('statusDot').classList.toggle('connected', connected);
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        async function refreshData() {
            if (connectionType === 'metamask' || connectionType === 'rpc') {
                await fetchTokenData();
            } else if (connectionType === 'api') {
                await fetchMockAPIData();
            }
        }

        function exportData() {
            // Export current data to CSV
            let csv = 'Token,Total Supply,Volume,Transfers\n';
            
            for (const [symbol, data] of Object.entries(tokenData)) {
                csv += `${symbol},${data.totalSupply},${data.volume},${data.transfers}\n`;
            }
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chiliz-tokens-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        function disconnect() {
            provider = null;
            contracts = {};
            connectionType = null;
            tokenData = {};
            
            document.getElementById('dataSection').style.display = 'none';
            document.getElementById('chartsSection').classList.remove('active');
            document.querySelectorAll('.connection-card').forEach(card => {
                card.classList.remove('active');
            });
            
            updateConnectionStatus('Disconnected', false);
            showSuccess('Disconnected from blockchain');
        }
    </script>
</body>
</html>